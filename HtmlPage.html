<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <link rel="stylesheet" href="StyleSheet.css">
</head>
<body id="body">
   
    <section id="section" ondrop="drop(event)" ondragover="allowDrop(event)">
    </section>

    <section id="section" ondrop="drop(event)" ondragover="allowDrop(event)"></section>

    <section id="section" ondrop="drop(event)" ondragover="allowDrop(event)"></section>

    <script>

        function allowDrop(event) {
    event.preventDefault();
}

        function updatefunc(e) {

            var sections = document.getElementsByTagName("SECTION");

            var saveTickets = [];
            var counter = 0;
            for (var i = 0; i < sections.length; i++) {
                var sectTickets = sections[i].children;
                for (var cn = 0; cn < sectTickets.length; cn++) {

                    saveTickets[counter] = Object.create(ticket);

                   
                    var children = sectTickets[cn].getElementsByTagName("div");

                    

                    for (var j = 0; j < children.length; j++) {
                        if (children[j].getAttribute('id') == 'HdrTxt') // any attribute could be used here
                        {

                            saveTickets[counter].Title = children[j].innerHTML;
                        }else

                            if (children[j].getAttribute('id') == 'ticketBody') // any attribute could be used here
                        {

                            saveTickets[counter].Body = children[j].innerHTML;
                        }else

                                if (children[j].getAttribute('id') == 'ticketFooter') // any attribute could be used here
                        {

                            saveTickets[counter].Author = children[j].innerHTML;
                        }
                    }
                    saveTickets[counter].SectionID = i;
                    counter++;
                }
            }


            localStorage.setItem("TicketData", JSON.stringify(saveTickets));

            
            var saveTickets = JSON.parse(localStorage.getItem("TicketData"));
            




        }

    function drop(event) {
        event.preventDefault();
        
        var data = event.dataTransfer.getData("Node");
        
        //event.target.appendChild(event.dataTransfer.getData(data));
       
           //drop in anderes Ticket verbieten
            var sectEle = event.target;
            while (sectEle.tagName != "SECTION") {
                sectEle = sectEle.parentElement;
            }
            sectEle.appendChild(draggedEle);
        
            updatefunc(event);
    }
    var draggedEle;
    function dragStart(event) {
        draggedEle = event.srcElement;
        event.dataTransfer.setData("Node", event.target.dataset.value);
    }

    var ticket = { Title: "John", Body: "Doe", Author: "Author", ID: 0, SectionID: 0 };

    var tickets = [];
   var saveTickets = JSON.parse(localStorage.getItem("TicketData"));
        for (var i = 0; i < (saveTickets==null?10:saveTickets.length); i++) {

           
            var currentTicket;
            if (saveTickets == null) {

                currentTicket = new Object(ticket);
            } else {
                currentTicket = saveTickets[i];
            }

            currentTicket.ID = i;


            tickets[i] = document.createElement("div");
            tickets[i].ondragstart = function () { dragStart(event); };
            tickets[i].id = "ticket";
           
            var ticketHead = document.createElement("div");
            
            ticketHead.id = "ticketHead";
            var HdrTxt = document.createElement("div");
            HdrTxt.id = "HdrTxt";
            HdrTxt.innerHTML = currentTicket.Title;
            ticketHead.appendChild(HdrTxt);
            var ticketDel = document.createElement("div");
            ticketDel.innerHTML = "X";
            ticketDel.id = "ticketDel";

            ticketDel.onclick = function (e) {
                e.srcElement.parentElement.parentElement.parentElement.removeChild(e.srcElement.parentElement.parentElement);
            };
            ticketHead.appendChild(ticketDel);
            var BodyTxt = document.createTextNode(currentTicket.Body);
           
            var ticketBody = document.createElement("div");
            ticketBody.appendChild(BodyTxt);
            ticketBody.id = "ticketBody";

            var ticketFooter = document.createElement("div");
            ticketFooter.id = "ticketFooter";
            var FtrTxt = document.createTextNode(currentTicket.Author);
            ticketFooter.appendChild(FtrTxt);


            tickets[i].appendChild(ticketHead);
            tickets[i].appendChild(ticketBody);
            tickets[i].appendChild(ticketFooter);
            //var element = document.getElementById("body")
            //element.appendChild(tickets[i]);


            var sections = document.getElementsByTagName("SECTION");
            sections[currentTicket.SectionID].appendChild(tickets[i]);
            

           
            //tickets[i].onmouseup = function (e) {
            //    hover = false;
            //    var numb1 = e.srcElement.style.top.match(/\d/g);
            //    var numb2 = section2.style.top.match(/\d/g);
            //    if (numb1 < numb2) {
            //        e.srcElement.parentElement.parentElement.removeChild(e.srcElement.parentElement);
            //        section1.appendChild(e.srcElement.parentElement);
            //    } else {
            //        e.srcElement.parentElement.parentElement.removeChild(e.srcElement.parentElement);
            //        section2.appendChild(e.srcElement.parentElement);
            //    }
            //    for (var i = 0; i < tickets.length; i++) {
            //        tickets[i].style = "ticket";
            //    }

            //}
            tickets[i].draggable = true;
            tickets[i].ondrag = function () { moveFunc(event); };
            tickets[i].oncontextmenu = function (e) {
                if (e.srcElement.id === "ticketBody" || e.srcElement.id === "ticketFooter" || e.srcElement.id === "HdrTxt") {
                    var promptCmd = prompt("Content:", e.srcElement.innerHTML);
                    if (promptCmd == null) {
                        e.srcElement.innerHTML = e.srcElement.innerHTML;
                       
                    } else {
                        e.srcElement.innerHTML = promptCmd;
                    }

                    
                   
                }
                return false;//disable default menu
                //BodyTxt = prompt("Content:", "...");
            };
            
            //var person = prompt("Please enter your name", "Harry Potter");
            //if (person != null) {
            //    document.getElementById("demo").innerHTML =
            //    "Hello " + person + "! How are you today?";
            //}
         

        }

        function moveFunc(e) {
            //if ( e.srcElement.id === "ticket") {
                
            //    e.srcElement.style.position = "absolute";
            //    e.srcElement.style.left = e.pageX - (e.srcElement.clientWidth / 2) + "px";
            //    e.srcElement.style.top = e.pageY - (e.srcElement.clientHeight / 2) + "px";
            //} else {
                
            //    e.srcElement.parentElement.position = "absolute";
            //    e.srcElement.parentElement.style.left = e.pageX - (e.srcElement.clientWidth / 2) + "px";
            //    e.srcElement.parentElement.style.top = e.pageY - (e.srcElement.clientHeight / 2) + "px";
            //}

            //e.srcElement.innerHTML = coor;
            //document.getElementById("demo").innerHTML = coor;
        }
    </script>
    <!--<style type="text/css">
        #move {
            height: 100px;
            width: 100px;
            position: absolute;
            top: 0;
            left: 0;
            background: green;
        }
    </style>
    <div id="move">
        sdfsfsfs
        sf
        sdf
        sf
        sd
        f
        s
    </div>-->
    <!--<script type="text/javascript">
			var div = document.getElementById('move');
			document.addEventListener('mousemove',function(e) {
				div.style.left = e.pageX+"px";
				div.style.top = e.pageY+"px";
			});
    </script>-->
</body>
</html>
